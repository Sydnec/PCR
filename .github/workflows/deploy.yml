name: Deploy to Production

on:
  push:
    tags:
      - 'v*' # Se dÃ©clenche uniquement sur les tags de version (ex: v1.0.0)

jobs:
  deploy:
    runs-on: self-hosted
    steps:
      - name: Execute deployment script
        run: |
          # ArrÃªt en cas d'erreur
          set -e
          
          echo "ğŸš€ DÃ©but du dÃ©ploiement sur le serveur (Self-hosted)..."
          
          # Aller dans le dossier du projet
          cd /home/sydnec/pcr
          
          # Mettre Ã  jour le code source (le tag qui vient d'Ãªtre pushÃ©)
          echo "ğŸ“¥ RÃ©cupÃ©ration de la derniÃ¨re version..."
          git fetch --all --tags
          git checkout main
          git pull origin main
          
          # Lancer le script de dÃ©ploiement interne
          # Cela gÃ¨re npm install et le redÃ©marrage PM2
          echo "ğŸ”„ ExÃ©cution du script de dÃ©ploiement..."
          bash ./pcr deploy
          
          echo "âœ… DÃ©ploiement terminÃ© avec succÃ¨s !"
